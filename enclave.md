In TEA Project, we use hardware TPM to verify a special area call **Enclave** is trusted. Enclave is special area inside a mining node. The *outisde* is called **parent instance** compare with enclave. 

Parent instance is a regular area that the OS or the miner (human) can access. But enclave is a special area that the OS and human miner cannot access.

That is to say, anything is running inside the enclave is unknown to the outside world. Consider the physical concept "blackhole horizon".  However, enclave is not a blackhole, the computing result can be sent out to the outside world. 

# The rule of data transfer in and out
If a data (or code) is supposed to be secret, when it is tranferring out from the enclave, it will be encrypted. After ecnryption, they can be transfer to other node or store to any storage. But when it is load into the enclave again, it will be decrypted.

# The key of enclave
The encryption key is the TPM's hardware key. This key will never be exposed to outside world. See the TPM security documents.

Besides the main key generated by the TPM hardware, there are derived keys that will be used for multiple purpose. All of them will stay inside enclave memory all the time. If they have to leave the enclave, they will be encrypted using the upper level (the top level is the hardware TPM key) first.

# There is no network nor file system inside Enclave
Inside the enclave, a special stripped version of Nix OS (A distribute of linux operating system) is used. In order to reduce the attack surface, only a few core features are compiled into this special core NixOS. Some popular features are forbidden: File system or Network is not existing inside the enclave.

# Communication between enclave and parent instance
Since there is no file system or network inside enclave, if an actor wants to contact to the outside world, the only channel would be using [[VMH]] (Virtual Messaging Hub). VMH API is wrappered inside providers. So that if an actor has such a [[capability]], the code in this actor can call the provider' API to send messages to the VMH. The outsider components will receive such message asynchronizely. 

# Remote Attestation
The TPM genreates the PCR hash array against the enclave. When a verifier is assgiend to remote attest a testee, the testee will send the PCR data signed by the TPM. The verifier first verify the TPM signature, then verify the PCR value again the testee's public reveal information. If they match, the verifier sign a "true" result to layer one. If not, the verifier sign a "false" result to the layer one.

Layer one (blockchain) run basic BFT to consider a testee pass the remote attestation or not.

The content of PCR include all hardware and software fingerprint in the enclave. Any changes on the enclave may cause remote attestation failure.

# Only verified enclave can join TEA network
Every enclave will have a [[TeaID]]. This TEAID has an entry in the layer one that stored the verification status. When a enclave wants to contact with another enclave, they will first check their TEAID verification status. If the status is not "Verified", the connection will not be estabilished.


